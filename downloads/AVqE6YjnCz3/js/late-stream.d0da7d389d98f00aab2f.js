"use strict";(self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[]).push([[2276],{12850:(e,t,n)=>{n.r(t),n.d(t,{default:()=>u});var a=n(15564),r=n(90082),i=n(32484),l=n(71687);const{TEXTURE_SETTINGS:s,clearRaycastHits:o}=i.yJ;const u=async function(e){const t=await e.getModuleBySymbol(r.ZF),n=await e.getModuleBySymbol(l.GR),i=t.addPanel(a.F.TITLE,a.F.HOTKEYS,{width:350});await t.loadPromise.then((()=>{const e="meshtextures";[{panel:i,header:e,setting:"disableTextureStreamBelowLod",initialValue:()=>-1,onChange:e=>{e>-1&&n.textureQualityMap.limitStreamingBelow(e)},urlParam:!0,rangePrecision:0,range:[-1,7]},{panel:i,header:e,setting:"textureStreamPause",initialValue:()=>s.debugPauseTexStream,onChange:e=>{s.debugPauseTexStream=e},urlParam:!0},{panel:i,header:e,setting:"textureStreamRaycastHits",initialValue:()=>s.debugLOD,onChange:e=>{s.debugLOD=e,e||o()},urlParam:!0},{panel:i,header:e,setting:"debugRTTQuality",initialValue:()=>s.debugRttQuality,onChange:e=>{s.debugRttQuality=e,e||n.setMeshOverlay({})},urlParam:!0},{panel:i,header:e,setting:"debugRTTScores",initialValue:()=>s.debugRttScores,onChange:e=>{s.debugRttScores=e,e||n.setMeshOverlay({})},urlParam:!0}].forEach((e=>t.registerMenuEntry(e)))}))}},86465:(e,t,n)=>{n.r(t),n.d(t,{default:()=>m});var a=n(68909),r=n(84440),i=n(25316),l=n(90082),s=n(26072),o=n(10121),u=n(47299),d=n(50839),g=n(90351),h=n(2593),c=n(71687);async function m(e){const t=await e.getModuleBySymbol(c.GR),[n,m,p]=await Promise.all([e.market.waitForData(i.o),e.getModuleBySymbol(l.ZF),e.getModuleBySymbol(c.UN)]);await m.loadPromise.then((()=>{m.registerButton("Mesh","Toggle visible",(()=>{t.meshes.forEach((e=>{e.modelMesh.visible=!e.modelMesh.visible}))})),m.registerButton("Mesh","Toggle UV debug",(()=>{t.meshes.forEach((e=>{const n=e.renderer.chunkRenderingModeOverride?null:o.f.UV;t.setChunkRenderingMode(n)}))})),m.registerButton("Mesh","Toggle depth",(()=>{t.meshes.forEach((e=>{const n=e.renderer.chunkRenderingModeOverride?null:o.f.Depth;t.setChunkRenderingMode(n)}))})),m.registerButton("Mesh","Toggle transparent",(()=>{t.meshes.forEach((e=>{const n=e.renderer.chunkRenderingModeOverride?null:o.f.Transparent;t.setChunkRenderingMode(n)}))})),m.registerButton("Mesh","Toggle wireframe",(()=>{t.meshes.forEach((e=>{const n=e.renderer.chunkRenderingModeOverride?null:o.f.Wireframe;t.setChunkRenderingMode(n)}))}));let e=!0===Boolean(new URLSearchParams(window.location.search).get("flat"));const i=()=>{t.meshes.forEach((t=>{t.modelMesh instanceof g.f&&t.modelMesh.notifyOnChunksLoaded((t=>{for(const n of t)n.setFlatShading(e)}));for(const n of t.modelMesh.chunks)n.setFlatShading(e)}))};i(),m.registerButton("Mesh","Toggle flat shading",(()=>{e=!e,i()}));const l=(()=>{let e=!1;return(n,i)=>{const l=new a.Vector4(1,1,1,0);var s;e=!e,s=n||e,t.meshes.forEach((e=>{for(const t of e.modelMesh.chunks){const e=i?100*t.id:100*t.meshSubgroup,n=s?(0,r.Zd)(.5,e):l;t.setColorOverlay(n)}}))}})();m.registerButton("Mesh","Highlight Rooms",l),m.registerButton("Mesh","Highlight Chunks",(()=>l(!0,!0))),n.onPropertyChanged(u.Vp,(e=>{t.meshes.forEach((t=>{const n=p.getFullBounds();for(const a of t.modelMesh.chunks)a.setMaterialsUniform({floorTrimHeight:1-e/100,floorHeightMin:n.min.y,floorHeightMax:n.max.y},!0)}))}));const c=(e,t,a,r,i)=>{m.registerSetting(e,t,a,!0,s.u.NONE,i),n.onPropertyChanged(t,r)};c("Wireframe",u._Z,!1,(e=>{t.meshes.forEach((t=>{for(const n of t.modelMesh.chunks)n.setWireframe(e)}))}));const M={[d.d.Wireframe]:{Wireframe:["thickness","wireframeOpacity","stroke","fillEnabled","fill","insideAltColor","dualStroke","secondThickness"],"Wireframe Dashes":["dashEnabled","dashLength","dashAnimate","dashOverlap"],"Wireframe Advanced":["squeeze","squeezeMin","squeezeMax"]}};for(const e in M){const n=h.fu.uniforms[e];for(const a in M[e])for(const r of M[e][a])c(a,r,n[r].value,(e=>{t.meshes.forEach((t=>{for(const n of t.modelMesh.chunks)n.setMaterialsUniform({[r]:e})}))}),n[r].range)}}))}},72311:(e,t,n)=>{n.r(t),n.d(t,{default:()=>k,tiledMeshDebugMenu:()=>w});var a=n(68909),r=n(90082),i=n(85826),l=n(244),s=n(24241),o=n(75778),u=n(71687),d=n(48539),g=n(84440),h=n(25712),c=n(32484),m=n(47299),p=n(15564);const M=new s.Vy("tiled-mesh"),{TILEDMESH_SETTINGS:f}=c.yJ,y={hideMenu:"1"!==(0,o.P3)("dmenu","0"),debug:"1"===(0,o.P3)("debugTiles","0")||"1"===(0,o.P3)("debug-tiles","0"),statsTiles:!1,statsTileset:!0,statsTextures:!0,statsTextureStream:!0};let T=null;function b(e,t,n){T||(T=document.createElement("div"),T.style.color="#FFFFFF",T.style.fontFamily="Roboto",T.style.fontWeight="300",T.style.fontSize="12px",T.style.position="absolute",T.style.top="85px",T.style.width="500px",T.style.pointerEvents="none",T.style.whiteSpace="pre",T.style.zIndex="99999",T.style.textShadow="0 0 1px black, 0 0 1px black, 0 0 1px black, 0 0 1px black",document.body.appendChild(T));let a="\n\n";a+=function(e){const t=e.threeRenderer.info,n=`three:\n  drawCalls: ${t.render.calls}\n  geometries: ${t.memory.geometries}\n  textures: ${t.memory.textures}\n  triangles: ${t.render.triangles}\n  memory allocated (megs): ${Math.floor(e.estimatedGPUMemoryAllocated()/2**20)}`;return n}(e),a+=y.statsTextureStream?function(e){const t=`\ntextureStreaming:\n  downloadingTiles: ${e.downloadingTiles} / ${e.totalTiles}\n  downloadingTextures: ${e.loadingTextures}\n`,n="  downloaded:\n"+Object.keys(e.totalTextures).map((t=>`    ${t}: ${e.totalTextures[t]} `)).join("\n")+"\n";return t+n}(n):"",t.forEach(((e,t)=>{const n=e.modelMesh;a+=`\n\n<mesh: id:${t}>`,a+=y.statsTileset?function(e,t){var n,a,r;const i=e.tilesRenderer,l=Object.values(null!==(n=i.tileSets)&&void 0!==n?n:[])[0];return`\n  tileset: preset: ${null===(a=null==l?void 0:l.asset.extras)||void 0===a?void 0:a.preset}, depth: ${null===(r=null==l?void 0:l.asset.extras)||void 0===r?void 0:r.depth}, version: ${null==l?void 0:l.asset.tilesetVersion}\n  view: errorTarget: ${t.settings.errorTarget}, maxLOD: ${t.settings.maxLOD}, detail: '${t.detail}'\n`}(n.tileLoader,n):"",a+=y.statsTiles?function(e){const t=e.tilesRenderer,n=t.visibleTiles,a={};n.forEach((e=>{var t;const n=`lod${null===(t=e.extras)||void 0===t?void 0:t.level}`,r=a[n]||0;a[n]=r+1}));const{stats:r,downloadQueue:i,parseQueue:l,lruCache:s}=t,{active:o,downloading:u,inFrustum:d,parsing:g,used:h,visible:c}=r,m=`  tiles:\n    tiles in frustum: ${d}\n    visible: ${c}`+Object.keys(a).sort().map((e=>`\n     ${e} tiles: ${a[e]||0}`)).join()+`\n    downloading gltf: ${u}\n    parsing gltf: ${g}\n    active: ${o}\n    used: ${h}\n    queues:\n      download: ${i.currJobs} running, ${i.items.length} waiting\n      parse: ${l.currJobs} running, ${l.items.length} waiting\n    lruCache: ${s.itemSet.size}\n`;return m}(n.tileLoader):"",a+=`</mesh: id:${t}>`})),T.textContent=a}function v(e,t,n,r,l,s){x&&(e.forEach(((e,n)=>{S.has(e.modelMesh)||(S.add(e.modelMesh),E.push(...function(e,t,n,r){const i=[{panel:e,header:t.tile+": "+n,setting:"maxLOD: "+n,initialValue:()=>r.settings.maxLOD,onChange:e=>{r.settings.maxLOD=e},range:[0,4],rangePrecision:0},{panel:e,header:t.tile+": "+n,setting:"nonMeshMaxLOD: "+n,initialValue:()=>r.settings.nonMeshMaxLOD,onChange:e=>{r.settings.nonMeshMaxLOD=e},range:[0,4],rangePrecision:0},{panel:e,header:t.tile+": "+n,setting:"minLOD: "+n,initialValue:()=>r.settings.minLOD,onChange:e=>{r.settings.minLOD=e},range:[0,4],rangePrecision:0},{panel:e,header:t.tile+": "+n,setting:"errorTarget:"+n,initialValue:()=>r.settings.errorTarget,onChange:e=>{r.settings.errorTarget=e},range:[0,20],rangePrecision:1,urlParam:!0},{panel:e,header:t.tile+": "+n,setting:"disableTileUpdates:"+n,initialValue:()=>r.settings.disableTileUpdates,onChange:e=>{r.settings.disableTileUpdates=e}},{panel:e,header:t.tile+": "+n,setting:"disposeModel: "+n,initialValue:()=>r.settings.disposeModel,onChange:e=>{r.settings.disposeModel=e}},{panel:e,header:t.tile+": "+n,setting:"pos on z axis: "+n,initialValue:()=>0,onChange:e=>{r.position.copy(new a.Vector3(0,0,e)),r.updateMatrixWorld(!0)},range:[-100,100],rangePrecision:0}];return i}(t,r,n,e.modelMesh)),E.push(...function(e,t,n,a,r,l){const s=a.tileLoader,o=P(s,l,((e,t)=>e.setWireframe(t))),u=function(e,t){const n={scale:1},a=(t,a)=>{if(!t)return;const r=e.container.tilesByChunkId.get(t.id),i=(null==r?void 0:r.__error)||1e-4,l=t.lod!==f.maxLOD&&i>f.errorTarget?1:.5,s=Math.max(0,Math.min(1,1-n.scale/i)),o=a?V(t.lod,s,l):null;t.setColorOverlay(o)},r=P(e,t,a),l=(0,i.f)((()=>r.colorize(e.container.chunks)));return{toggle:e=>{e?l.renew():l.cancel(),r.toggle(e)},colorize:r.colorize,subscription:l,config:n}}(s,l),d=P(s,l,((e,t)=>{e.setColorOverlay(t?V(e.lod,1,.5):null)})),c=P(s,l,((e,t)=>{e.setColorOverlay(t?(0,g.Zd)(.5,e.id||0):null)})),m=P(s,l,((e,t)=>{var n;const a=s.container.tilesByChunkId.get(e.id);e.setColorOverlay(t?(0,g.Zd)(.5,(0,h.s5)((null===(n=null==a?void 0:a.content)||void 0===n?void 0:n.uri)||"missing")||0):null)})),p=P(s,l,((e,t)=>{e.setColorOverlay(t?(0,g.Zd)(.5,(e.meshGroup<<16)+e.meshSubgroup||0):null)})),y=P(s,l,((e,t)=>{e.setColorOverlay(t?(0,g.Zd)(.5,e.meshSubgroup||0):null)})),T=P(s,l,((e,t)=>{e.setColorOverlay(t?(0,g.Zd)(.5,e.meshGroup||0):null)})),b=P(s,l,((e,t)=>{e.setColorOverlay(t?(0,g.Zd)(.5,(0,h.s5)(e.textureName)||0):null)})),v=P(s,l,((e,t)=>{const n=s.container.tilesByChunkId.get(e.id);e.setColorOverlay(t?(0,g.Zd)(.5,(null==n?void 0:n.geometricError)||0):null)})),E=r.slots,S=a.textureQualityMap,x=P(s,l,((e,t)=>{const n=E.find((t=>t.textureName===e.textureName));if(n){const a=n.loading?1:n.quality>S.min(e.lod)?.7:.3,r=S.maxTexelSize/S.get(n.quality).texelSize;e.setColorOverlay(t?V(e.lod,r,a):null)}})),C=(0,i.f)((()=>x.colorize(s.container.chunks)));let w="none";const O={none:void 0,byError:u,byGeometricError:v,byTile:m,bySubgroup:y,byMeshgroup:T,bySubAndMeshgroup:p,byTexture:b,byStreamedTextures:{subscription:C,toggle:e=>{e?C.renew():C.cancel(),e&&M.info("colorize=byStreamedTextures solid color: loading, dark color: streamed, light color: basis"),x.toggle(e)}},byChunk:c,byLod:d},k=[{panel:e,header:`${t.viz}: ${n}`,setting:"disableTileUpdates:"+n,initialValue:()=>a.settings.disableTileUpdates,onChange:e=>{a.settings.disableTileUpdates=e},urlParam:!0},{panel:e,header:`${t.viz}: ${n}`,setting:"wireframe:"+n,initialValue:()=>!1,onChange:o.toggle,urlParam:!0},{panel:e,header:`${t.viz}: ${n}`,setting:"colorize:"+n,initialValue:()=>"none",onChange:e=>{var t,n;null===(t=O[w])||void 0===t||t.toggle(!1),null===(n=O[e])||void 0===n||n.toggle(!0),w=e},options:Object.keys(O),urlParam:!0},{panel:e,header:`${t.viz}: ${n}`,setting:"colorizeByErrorScale:"+n,initialValue:()=>1,onChange:e=>{u.config.scale=e},range:[0,6],rangePrecision:3,urlParam:!0}];return k}(t,r,n,e.modelMesh,l,s)))})),E.length&&(E.forEach((e=>n.registerMenuEntry(e))),E.length=0))}const E=[],S=new Set;let x=!1,C=null;async function w(e){if(!y.debug)return;const t=await e.getModuleBySymbol(r.ZF),n=await e.getModuleBySymbol(u.mL),a=await e.getModuleBySymbol(u.M7),i=a.getScene(),l=await e.getModuleBySymbol(u.GR);await l.firstMeshLoadPromise,await(0,d.cb)(100);const s=l.meshes,o=l.meshTextureLoader,g=t.tryGetProperty(m.sz,!1),h=t.addPanel(p.F.TITLE,p.F.HOTKEYS,{width:350}),c={viz:"visualize",stats:"stats",tile:"tileset",log:"log"};function T(){C||(C=setInterval((()=>{b(a,s,o),v(s,h,t,c,o,e)}),150))}const E=[{panel:h,header:c.stats,setting:"tilesetStatsOverlay",initialValue:()=>y.statsTileset,onChange:e=>{y.statsTileset=e,e&&T()},urlParam:!0},{panel:h,header:c.stats,setting:"tileStatsOverlay",initialValue:()=>y.statsTiles,onChange:e=>{y.statsTiles=e,e&&T()},urlParam:!0},{panel:h,header:c.stats,setting:"textureStatsOverlay",initialValue:()=>y.statsTextures,onChange:e=>{y.statsTextures=e,e&&T()},urlParam:!0},{panel:h,header:c.stats,setting:"textureStreamingOverlay",initialValue:()=>y.statsTextureStream,onChange:e=>{y.statsTextureStream=e,e&&T()},urlParam:!0}],S=[{panel:h,header:c.log,buttonName:"Log: App State",callback:()=>{M.warn(s),M.warn(n),M.warn(i),M.warn(t)}}];g&&(y.hideMenu||await(0,d.cb)(1e3).then((()=>{t.getSettingsGui().loadGuiPackage().then((()=>{t.getSettingsGui().toggle(t.getMainPanelId()),t.getSettingsGui().toggle(t.getMainPanelId())}))})),await(0,d.cb)(16),x||(await(0,d.cb)(16),x=!0,function(e,t,n,a){const r=[{panel:e,header:t.tile,setting:"smallMeshThreshold",initialValue:()=>f.smallMeshThreshold,onChange:e=>{f.smallMeshThreshold=e,a.forEach((t=>{t.modelMesh.settings.smallMeshThreshold=e}))},range:[0,100],rangePrecision:1,urlParam:!0},{panel:e,header:t.tile,setting:"smallMeshErrorMultiplier",initialValue:()=>f.smallMeshErrorMultiplier,onChange:e=>{f.smallMeshErrorMultiplier=e,a.forEach((t=>{t.modelMesh.settings.smallMeshErrorMultiplier=e}))},range:[.01,2],rangePrecision:2,urlParam:!0},{panel:e,header:t.tile,setting:"displayActiveTiles",initialValue:()=>f.displayActiveTiles,onChange:e=>{f.displayActiveTiles=e,a.forEach((t=>{t.modelMesh.settings.displayActiveTiles=e}))},urlParam:!0},{panel:e,header:t.tile,setting:"loadSiblings",initialValue:()=>f.loadSiblings,onChange:e=>{f.loadSiblings=e,a.forEach((t=>{t.modelMesh.settings.loadSiblings=e}))},urlParam:!0},{panel:e,header:t.tile,setting:"autoDisableRendererCulling",initialValue:()=>f.autoDisableRendererCulling,onChange:e=>{f.autoDisableRendererCulling=e,a.forEach((t=>{t.modelMesh.settings.autoDisableRendererCulling=e}))},urlParam:!0},{panel:e,header:t.tile,setting:"stopAtEmptyTiles",initialValue:()=>f.stopAtEmptyTiles,onChange:e=>{f.stopAtEmptyTiles=e,a.forEach((t=>{t.modelMesh.settings.stopAtEmptyTiles=e}))},urlParam:!0},{panel:e,header:t.tile,setting:"limitMemoryUsage",initialValue:()=>f.limitMemoryUsage,onChange:e=>{f.limitMemoryUsage=e,a.forEach((t=>{t.modelMesh.settings.limitMemoryUsage=e}))},urlParam:!0},{panel:e,header:t.tile,setting:"allocatedMegsBeforeLimitingLod",initialValue:()=>f.allocatedMegsBeforeLimitingLod,onChange:e=>{f.allocatedMegsBeforeLimitingLod=e,a.forEach((t=>{t.modelMesh.settings.allocatedMegsBeforeLimitingLod=e}))},urlParam:!0,range:[100,1e3]},{panel:e,header:t.tile,setting:"lruMinExtraTiles",initialValue:()=>f.lruMinExtraTiles,onChange:e=>{f.lruMinExtraTiles=e,a.forEach((t=>{t.modelMesh.settings.lruMinExtraTiles=e}))},urlParam:!0,range:[0,2e3]},{panel:e,header:t.tile,setting:"lruMaxTiles",initialValue:()=>f.lruMaxTiles,onChange:e=>{f.lruMaxTiles=e,a.forEach((t=>{t.modelMesh.settings.lruMaxTiles=e}))},urlParam:!0,range:[0,2e3]},{panel:e,header:t.tile,setting:"lruUnloadPercent",initialValue:()=>f.lruUnloadPercent,onChange:e=>{f.lruUnloadPercent=e,a.forEach((t=>{t.modelMesh.settings.lruUnloadPercent=e}))},urlParam:!0,range:[0,1]},{panel:e,header:"Priority",setting:"errorMultiplierRaycastOcclusion",initialValue:()=>f.errorMultiplierRaycastOcclusion,onChange:e=>{f.errorMultiplierRaycastOcclusion=e,a.forEach((t=>{t.modelMesh.settings.errorMultiplierRaycastOcclusion=e}))},range:[.001,1],rangePrecision:2},{panel:e,header:"Priority",setting:"errorMultiplierHiddenFloors",initialValue:()=>f.errorMultiplierHiddenFloors,onChange:e=>{f.errorMultiplierHiddenFloors=e,a.forEach((t=>{t.modelMesh.settings.errorMultiplierHiddenFloors=e}))},range:[.001,1],rangePrecision:2}];return r}(h,c,0,s).forEach((e=>t.registerMenuEntry(e))),E.forEach((e=>t.registerMenuEntry(e))),S.forEach((e=>t.registerMenuButton(e)))))}function P(e,t,n){let a=!1;const r=e=>{t.after(l.R.End).then((()=>{e.forEach((e=>{e&&n(e,a)}))}))},i=e.notifyOnChunksLoaded(r);i.cancel();return{toggle:t=>{t?i.renew():i.cancel(),t!==a&&(a=t,r([...e.container.chunks]))},colorize:r,subscription:i}}const O={0:new a.Vector4(1,0,0,1),1:new a.Vector4(0,1,0,1),2:new a.Vector4(0,0,1,1),3:new a.Vector4(1,1,1,1),4:new a.Vector4(1,0,1,1),5:new a.Vector4(0,1,1,1),6:new a.Vector4(1,1,0,1),7:new a.Vector4(0,0,0,1)};function V(e,t,n){var r,i;const l=null!==(i=null===(r=O[e])||void 0===r?void 0:r.clone())&&void 0!==i?i:new a.Vector4;return l.multiplyScalar(t),l.setW(n),l}const k=w},15564:(e,t,n)=>{n.d(t,{F:()=>a});const a={TITLE:"streamed-mesh (T)",HOTKEYS:[n(71397).D.T]}},32484:(e,t,n)=>{n.d(t,{yJ:()=>l});var a=n(80112),r=n(47299),i=n(14971);const l={TEXTURE_SETTINGS:r.Ay,TILEDMESH_SETTINGS:a.W,clearRaycastHits:i.Jn}},83075:(e,t,n)=>{n.d(t,{PO:()=>r,m2:()=>i});var a=n(99276);const r=e=>!!e&&e instanceof a.B,i={hasMeshGroup:e=>"object"==typeof e&&!!e&&"meshGroup"in e,hasMeshSubgroup:e=>"object"==typeof e&&!!e&&"meshSubgroup"in e,isRoomMesh:r,isVisibleRoomMesh:e=>r(e)&&e.raycastEnabled&&e.visible}}}]);