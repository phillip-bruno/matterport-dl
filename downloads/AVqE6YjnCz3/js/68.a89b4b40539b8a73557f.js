"use strict";(self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[]).push([[68],{4679:(t,e,i)=>{i.d(e,{e:()=>l});var s=i(68909),r=i(90303),n=i(98051),o=i(40397),a=i(40160);class h extends s.Mesh{constructor(t,e,i=a.UP.endpointSelected,s=a.UP.endpointDefault){super(t,e),this.selectedSize=i,this.defaultSize=s,this.currentSize=a.UP.endpointDefault,this.currentSize=this.defaultSize,this.scale.set(a.Mg,a.Mg,a.Mg)}dispose(){this.material.dispose(),this.geometry.dispose()}billboardScale(t,e,i){const s=(0,o.Nv)(e,t,this.position,i,.5),r=Math.max(Math.min(1/s*this.currentSize,a.q6),a.Mg);this.scale.set(r,r,r)}updateSelected(t){this.currentSize=t?this.selectedSize:this.defaultSize}}var c=i(37458),u=i(52943),d=i(30443);class l{constructor(t,e,i,a,l){this.lineMaterial=i,this.options=a,this.endpointMaterial=l,this.startPosition=new s.Vector3,this.endPosition=new s.Vector3,this.endpoints=!1,this.isVisible=!0,this.meshToLinePartMap={},this.opacity=t=>(this.endpointMaterial&&this.endpointMaterial.setOpacity(t),this.lineMesh.material.setOpacity(t),this),this.updatePositions=(t,e)=>(this.startPosition.copy(t),this.endPosition.copy(e),this.options.beforeUpdatePositions&&(t=this.options.beforeUpdatePositions(t),e=this.options.beforeUpdatePositions(e)),this.lineMesh.geometry.setPositions([t.x,t.y,t.z,e.x,e.y,e.z]),this.endpoints&&(this.endMesh.position.copy(e),this.startMesh.position.copy(t),this.lastBillboardOptions&&this.updateBillboard(this.lastBillboardOptions)),this.lineMesh.material.dashed&&this.lineMesh.computeLineDistances(),this),this.updateBillboard=t=>{if(this.endpoints&&(t.rotation&&(this.endMesh.quaternion.copy(t.rotation),this.startMesh.quaternion.copy(t.rotation)),t.position&&t.projection&&!(0,o.Rc)(t.projection))){const e=this.lineMesh.material.resolution.y;this.endMesh.billboardScale(t.position,t.projection,e),this.startMesh.billboardScale(t.position,t.projection,e)}return this.lastBillboardOptions=t,this},this.updateSelected=t=>(this.lineMesh.material.updateSelected(t),this.endpoints&&(this.endMesh.material.updateHovered(t),this.endMesh.updateSelected(t),this.startMesh.updateSelected(t)),this),this.setRenderLayer=t=>{this.children.forEach((e=>e.layers.mask=t.mask))},this.setRenderOrder=t=>{this.children.forEach((e=>e.renderOrder=t))},this.updateResolution=(t,e)=>(this.lineMesh.material.resolution.set(t,e),this),this.hide=()=>{this.options.onHide&&this.options.onHide(),this.isVisible=!1},this.show=()=>{this.options.onShow&&this.options.onShow(),this.isVisible=!0},this.toggle=t=>(t?this.show():this.hide(),this),this.dispose=()=>{this.options.onHide&&this.options.onHide(),this.lineMesh.geometry.dispose(),this.lineMesh.material.dispose(),this.endMesh&&this.endMesh.dispose(),this.startMesh&&this.startMesh.dispose(),this.meshToLinePartMap={}},this.overrideLineMaterial=t=>{this.lineMesh.material=t},this.restoreLineMaterial=()=>{this.lineMesh.material=this.lineMaterial},this.startPosition.copy(t),this.endPosition.copy(e),this.lineMesh=new r.N(new n.v,i),this.lineMesh.matrixAutoUpdate=!1,this.lineMesh.part=u.Y.line,this.lineMesh.renderOrder=c.X.lines,this.meshToLinePartMap[u.Y.line]=this.lineMesh,l&&(this.endpoints=!0,this.endMesh=new h((0,d.Wi)(),l),this.endMesh.part=u.Y.end,this.endMesh.renderOrder=c.X.endpoints,this.meshToLinePartMap[u.Y.end]=this.endMesh,this.startMesh=new h((0,d.Wi)(),l),this.startMesh.part=u.Y.start,this.startMesh.renderOrder=c.X.endpoints,this.meshToLinePartMap[u.Y.start]=this.startMesh),this.updatePositions(this.startPosition,this.endPosition),this.updateSelected(!1)}get currentOpacity(){return this.lineMesh.material.getOpacity()}getMesh(t){return this.meshToLinePartMap[t]}get children(){return Object.keys(this.meshToLinePartMap).map((t=>this.meshToLinePartMap[t]))}get visible(){return this.isVisible}}},52943:(t,e,i)=>{var s;i.d(e,{Y:()=>s}),function(t){t.line="line",t.start="start",t.end="end"}(s||(s={}))},40266:(t,e,i)=>{i.r(e),i.d(e,{default:()=>S,makeEndpointMaterial:()=>b,makeLineMaterial:()=>w});var s=i(75578),r=i(71687),n=i(68909),o=i(4679),a=i(32024);var h;!function(t){t[t.LINE_DEFAULT=0]="LINE_DEFAULT",t[t.LINE_HOVER=1]="LINE_HOVER",t[t.END_DEFAULT=2]="END_DEFAULT",t[t.END_HOVER=3]="END_HOVER"}(h||(h={}));class c{constructor(){const t=(0,a.y)("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAJ1BMVEUAAAD///////////////////////////////////////////////+uPUo5AAAADHRSTlMA4ZNBI+fLwLSGYE5aqgIgAAAAlUlEQVQoz2MAAy91mYNFSxjgwEjmDBAcVIbxPWPOgMHRKRA+c88ZKDhhABbYdgYOssEKchACx0BKPM4ggRagwBxkgZNAHTHIAkcNGJjOoAAFBkdUARGGNagCpxh0UAUOMdSgChxnkEEVOMhwBg1gCGBowTAUw1oMh2E4HcNzGN5HDyCMIMQIZPRowIgozKjEjGyM5AAACSg5ooJJElsAAAAASUVORK5CYII="),e=(0,a.y)("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAPFBMVEUAAAD/AVL/AVL/AVL/AVL/AVL/AVL/AVL/AVL/AVL/AVL/AVL/////+fr/5er/0tv/ytX/iaH/dJL/cpA84uD/AAAAC3RSTlMA45NBI8vAtIZgTrS8MGcAAAC5SURBVDjLhVPtDoQgDBuICPKpvP+7Xs4t6LlL2j9GWtYCG91w0XqTkvE2OtJYrEkTxi4v2gWhpyS4n+1bUtgeRfY1/cG6z/3Ma8Ui/rP+6LWU2sd04RxBfs+WBe2UpXAZSP4jP3DIWb4m9ua1whI5w/XzC+xiHEWWtreg8XoUh5EVhnj469u1oF+EJ45QtaByCGKrogWFGSiAFjAkPCa8KHjV6LHgc6OGgS2Hmha2PR4cPHp4eOH4fwAGdiPh+RS0GAAAAABJRU5ErkJggg=="),i=(0,a.y)("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAIBAMAAABqq+CcAAAAD1BMVEUAAAD///////////////+PQt5oAAAABHRSTlMAy4AzqjrmZgAAABRJREFUCNdjAAMjERcXR2Uwc4AEAIn2CZHn9cAcAAAAAElFTkSuQmCC"),s=(0,a.y)("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAIBAMAAABqq+CcAAAAGFBMVEUAAAD/AVL/AVL/AVL/////AVL/r7//OWiicYg+AAAABHRSTlMAy4AzqjrmZgAAABlJREFUCNdjYGBgVgwtcwGC9FAhAyB3YAQAVg4X6a0jaXAAAAAASUVORK5CYII=");this.textures={[h.LINE_DEFAULT]:i,[h.LINE_HOVER]:s,[h.END_DEFAULT]:t,[h.END_HOVER]:e},i.minFilter=n.LinearFilter,s.minFilter=n.LinearFilter,t.minFilter=n.LinearFilter,e.minFilter=n.LinearFilter}get(t){return this.textures[t]}dispose(){for(const t in this.textures){const e=Number(t);this.get(e).dispose()}}}var u=i(36580);class d extends n.ShaderMaterial{constructor(t,e,i){const s=n.UniformsUtils.clone(u.i.endpoint.uniforms);super({fragmentShader:u.i.endpoint.fragmentShader,vertexShader:u.i.endpoint.vertexShader,uniforms:s,name:"LineEndpointMaterial",transparent:!0,depthWrite:!1,depthTest:!0}),this.color=t,this.defaultTex=e,this.hoverTex=i,this.uniforms.bg.value=e,this.uniforms.color.value.copy(this.color)}clone(){return new d(this.color,this.defaultTex,this.hoverTex).copy(this)}setOpacity(t){this.uniforms&&t!==this.uniforms.opacity.value&&(this.uniforms.opacity.value=t)}getOpacity(){return this.uniforms.opacity.value}updateHovered(t){const e=t?this.hoverTex:this.defaultTex;this.uniforms.bg.value!==e&&(this.uniforms.bg.value=e)}}var l=i(98034),p=i(20599),m=i(35568),f=i(37105),g=i(40160);let A=null;function y(){return A||(A=new c),A}class S extends s.n{constructor(){super(...arguments),this.name="lines"}async init(t,e){const i=await e.getModuleBySymbol(r.M7);this.scene=i.getScene(),this.canvas=await e.market.waitForData(f.p),this.cameraData=await e.market.waitForData(p.M),this.bindings.push(this.canvas.onChanged(this.onCanvasChange.bind(this))),this.cameraPosition=new n.Vector3,this.segments=[]}onUpdate(){this.cameraPosition.copy(this.cameraData.pose.position)}dispose(t){super.dispose(t),this.segments.forEach((t=>t.dispose()))}makeLine(t,e,i,s,r=()=>!1){const n=r()?g.HT.OFFSET_TOWARDS_CAMERA:0,a=r()?t=>this.cameraPosition.clone().sub(t).setLength(n).add(t):t=>t,h=new o.e(t,e,i,{beforeUpdatePositions:a,onShow:()=>h.children.forEach((t=>this.scene.addChild(m.o.Root,t))),onHide:()=>h.children.forEach((t=>this.scene.removeChild(m.o.Root,t)))},s);return h.updateResolution(this.canvas.width,this.canvas.height),h.opacity(1),h.show(),h.updatePositions(t,e),this.segments.push(h),h}makeLineMaterial(t,e,i={},s,r){return w(t,e,i,s,r)}makeEndpointMaterial(t,e,i){return b(t,e,i)}onCanvasChange(t){for(const e of this.segments)e.updateResolution(t.width,t.height)}}function b(t,e,i){const s=i||y().get(h.END_HOVER),r=e||y().get(h.END_DEFAULT);return new d(new n.Color(t),r,s)}function w(t,e,i={},s,r){const o=r||y().get(h.LINE_HOVER),a=s||y().get(h.LINE_DEFAULT),c=new n.Vector2(window.innerWidth,window.innerHeight);return e?new l.G(Object.assign({color:new n.Color(t),resolution:c},i),o,a):new l.G(Object.assign({color:new n.Color(t)},i))}},90303:(t,e,i)=>{i.d(e,{N:()=>n});var s=i(68909),r=i(52943);class n extends s.Mesh{constructor(t,e){super(),this.part=r.Y.line,this.computeLineDistances=(()=>{const t=new s.Vector3,e=new s.Vector3;return()=>{const i=this.geometry,r=i.attributes.instanceStart,n=i.attributes.instanceEnd,o=new Float32Array(2*r.data.count);for(let i=0,s=0,a=r.data.count;i<a;i++,s+=2)t.fromBufferAttribute(r,i),e.fromBufferAttribute(n,i),o[s]=0===s?0:o[s-1],o[s+1]=o[s]+t.distanceTo(e);return this.instanceDistanceBuffer?(this.instanceDistanceBuffer.set(o,0),this.instanceDistanceBuffer.needsUpdate=!0):(this.instanceDistanceBuffer=new s.InstancedInterleavedBuffer(o,2,1),i.setAttribute("instanceDistanceStart",new s.InterleavedBufferAttribute(this.instanceDistanceBuffer,1,0,!1)),i.setAttribute("instanceDistanceEnd",new s.InterleavedBufferAttribute(this.instanceDistanceBuffer,1,1,!1))),this}})(),this.geometry=t,this.material=e,this.type="Line"}copy(t){throw Error("not implemented")}}},98051:(t,e,i)=>{i.d(e,{v:()=>r});var s=i(84325);class r extends s.n{constructor(){super(),this.type="LineGeometry",this.isLineGeometry=!0}setPositions(t){const e=t.length-3,i=new Float32Array(2*e);for(let s=0;s<e;s+=3)i[2*s]=t[s],i[2*s+1]=t[s+1],i[2*s+2]=t[s+2],i[2*s+3]=t[s+3],i[2*s+4]=t[s+4],i[2*s+5]=t[s+5];return s.n.prototype.setPositions.call(this,i),this}setColors(t){const e=t.length-3,i=new Float32Array(2*e);for(let s=0;s<e;s+=3)i[2*s]=t[s],i[2*s+1]=t[s+1],i[2*s+2]=t[s+2],i[2*s+3]=t[s+3],i[2*s+4]=t[s+4],i[2*s+5]=t[s+5];return s.n.prototype.setColors.call(this,i),this}fromLine(t){throw new Error("LineGeometry.fromLine not converted to TS yet")}copy(t){return this}}},98034:(t,e,i)=>{i.d(e,{G:()=>o});var s=i(68909),r=i(36580),n=i(40160);class o extends s.ShaderMaterial{constructor(t,e,i,o=n.UP.lineSelected){super(),this.parameters=t,this.hoverTexture=e,this.defaultTexture=i,this.selectedWidth=o,this.isLineMaterial=!0,this.defaultWidth=n.UP.lineDefault,this.setValues({uniforms:s.UniformsUtils.clone(r.i.line.uniforms),vertexShader:r.i.line.vertexShader,fragmentShader:r.i.line.fragmentShader,transparent:!0,depthWrite:!1,depthTest:!0,opacity:1}),this.setValues(t),i&&(this.mask=i),this.defaultWidth=t&&t.linewidth?t.linewidth:n.UP.lineDefault}updateSelected(t){const e=t?this.hoverTexture:this.defaultTexture;e&&this.mask!==e&&(this.mask=e,t?this.setLinewidth(this.selectedWidth):this.setLinewidth(this.defaultWidth))}setLinewidth(t){this.uniforms.linewidth||(this.uniforms=s.UniformsUtils.clone(r.i.line.uniforms)),this.getLinewidth()!==t&&(this.uniforms.linewidth.value=t)}getLinewidth(){return this.uniforms.linewidth.value}get color(){return this.uniforms.diffuse.value}set color(t){this.uniforms.diffuse.value=t}getOpacity(){return this.uniforms.opacity.value}setOpacity(t){this.uniforms||(this.uniforms=s.UniformsUtils.clone(r.i.line.uniforms)),this.getOpacity()!==t&&(this.uniforms.opacity.value=t)}get dashScale(){return this.uniforms.dashScale.value}set dashScale(t){this.uniforms.dashScale.value=t}set dashed(t){t?this.defines.USE_DASH="":delete this.defines.USE_DASH,this.needsUpdate=!0}get dashed(){return"USE_DASH"in this.defines}get dashSize(){return this.uniforms.dashSize.value}set dashSize(t){this.uniforms.dashSize.value=t}get gapSize(){return this.uniforms.gapSize.value}set gapSize(t){this.uniforms.gapSize.value=t}get resolution(){return this.uniforms.resolution.value}set resolution(t){this.uniforms.resolution.value=t}set mask(t){this.uniforms.mask.value!==t&&(t?this.defines.USE_MASK="":delete this.defines.USE_MASK,this.uniforms.mask.value=t,this.needsUpdate=!0)}get mask(){return this.uniforms.mask.value}copy(t){return s.ShaderMaterial.prototype.copy.call(this,t),this.parameters=t.parameters,this.color.copy(t.color),this.defaultWidth=t.defaultWidth,this.setLinewidth(t.getLinewidth()),this.resolution.copy(t.resolution),this.defaultTexture=t.defaultTexture,this.hoverTexture=t.hoverTexture,this.mask=t.mask,this.setOpacity(t.getOpacity()),this.dashed=t.dashed,this.dashScale=t.dashScale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}},84325:(t,e,i)=>{i.d(e,{n:()=>r});var s=i(68909);class r extends s.InstancedBufferGeometry{constructor(){super(),this.type="LineSegmentsGeometry";this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new s.Float32BufferAttribute([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new s.Float32BufferAttribute([0,1,.5,1,0,.5,.5,.5,0,0,.5,0,0,1,.5,1],2))}applyMatrix(t){const e=this.attributes.instanceStart,i=this.attributes.instanceEnd;return void 0!==e&&void 0!==i&&(e.applyMatrix4(t),i.applyMatrix4(t),this.positionBuffer.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}setPositions(t){let e;return t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t)),e&&(this.positionBuffer?(this.positionBuffer.set(e,0),this.positionBuffer.needsUpdate=!0):(this.positionBuffer=new s.InstancedInterleavedBuffer(e,6,1),this.setAttribute("instanceStart",new s.InterleavedBufferAttribute(this.positionBuffer,3,0,!1)),this.setAttribute("instanceEnd",new s.InterleavedBufferAttribute(this.positionBuffer,3,3,!1))),this.computeBoundingBox(),this.computeBoundingSphere()),this}setColors(t){let e;return t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t)),e&&(this.colorBuffer?(this.colorBuffer.set(e,0),this.colorBuffer.needsUpdate=!0):(this.colorBuffer=new s.InstancedInterleavedBuffer(e,6,1),this.setAttribute("instanceColorStart",new s.InterleavedBufferAttribute(this.colorBuffer,3,0,!1)),this.setAttribute("instanceColorEnd",new s.InterleavedBufferAttribute(this.colorBuffer,3,3,!1)))),this}fromWireframeGeometry(t){return this.setPositions(t.attributes.position.array),this}fromEdgesGeometry(t){return this.setPositions(t.attributes.position.array),this}fromMesh(t){return this.fromWireframeGeometry(new s.WireframeGeometry(t.geometry)),this}fromLineSegements(t){const e=t.geometry;return e instanceof s.BufferGeometry&&this.setPositions(e.position.array),this}computeBoundingBox(){this.boundingBox||(this.boundingBox=new s.Box3),this.box||(this.box=new s.Box3);const t=this.attributes.instanceStart,e=this.attributes.instanceEnd;void 0!==t&&void 0!==e&&(this.boundingBox.setFromBufferAttribute(t),this.box.setFromBufferAttribute(e),this.boundingBox.union(this.box))}computeBoundingSphere(){this.tempVector||(this.tempVector=new s.Vector3),this.boundingSphere||(this.boundingSphere=new s.Sphere),this.boundingBox||this.computeBoundingBox();const t=this.attributes.instanceStart,e=this.attributes.instanceEnd;if(void 0!==t&&void 0!==e){const i=this.boundingSphere.center;this.boundingBox.getCenter(i);let s=0;for(let r=0,n=t.count;r<n;r++)this.tempVector.fromBufferAttribute(t,r),s=Math.max(s,i.distanceToSquared(this.tempVector)),this.tempVector.fromBufferAttribute(e,r),s=Math.max(s,i.distanceToSquared(this.tempVector));this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error("computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}}},99276:(t,e,i)=>{i.d(e,{B:()=>c});var s=i(68909),r=i(36476),n=i(30443),o=i(37458),a=i(5984),h=i(47299);class c extends a.r{constructor(t,e,i=r.H.ALL){super(),this._opacity=1,this._chunks=[],this.size=new s.Vector3,this.center=new s.Vector3,this.built=!1,this.layers.mask=i.mask,this.name=`RoomMesh:${t}-${e}`,this.meshGroup=t,this.meshSubgroup=e,this.renderOrder=o.X.default,this.castShadow=c.ShouldCastShadow,this.onBeforeRender=(t,e,i,s,r,n)=>{this.updateUniforms(r,n)}}dispose(){this.reset()}reset(){this._chunks.length=0,this.geometry.dispose(),delete this.onBuild,delete this.onOpacityUpdate,this.built=!1}addChunk(t){-1===this._chunks.indexOf(t)&&this._chunks.push(t)}getChunk(t){return this._chunks[t]}build(){if(this.built)throw new Error("build() should only be called once");if(!this._chunks.length)return;const t=(0,n.h0)(this._chunks.map((t=>t.geometry)));t.clearGroups();let e=0;this.material=[],this._chunks.forEach(((i,s)=>{i.geometry&&i.geometry.index&&(t.addGroup(e,i.geometry.index.count,s),e+=i.geometry.index.count,i.geometry.dispose(),i.geometry=t,i.notifyOnMaterialUpdated((t=>{Array.isArray(this.material)&&(this.material[s]=t),this.onMaterialUpdate&&this.onMaterialUpdate()})),i.onOpacityUpdate=t=>{this.opacity=t})})),this.geometry=t,this.geometry.computeBoundingBox(),this.geometry.computeBoundingSphere(),this.material=this._chunks.map((t=>t.material)),this.size=this.boundingBox.getSize(this.size),this.center=this.boundingBox.getCenter(this.center),this.built=!0,this.onBuild&&this.onBuild()}buildWithSingleChunk(t){if(this.built)return;const{meshGroup:e,meshSubgroup:i,lod:s}=t;this.name=`RoomMesh:${s}-${e}-${i}-${t.chunkIndex}`,this.meshGroup=e,this.meshSubgroup=i,this._chunks.push(t),t.notifyOnMaterialUpdated((t=>{this.material=t,this.onMaterialUpdate&&this.onMaterialUpdate()})),t.onOpacityUpdate=t=>{this.opacity=t},this.size=this.boundingBox.getSize(this.size),this.center=this.boundingBox.getCenter(this.center),this.built=!0,this.onBuild&&this.onBuild()}updateUniforms(t,e){t instanceof s.ShaderMaterial&&(e?this.chunks[e.materialIndex].onBeforeDraw(t):this.chunks.length&&this.chunks[0].onBeforeDraw(t))}get boundingBox(){return(0,n.UX)(this.geometry)}set opacity(t){t!==this.opacity&&(this._opacity=t,this.raycastEnabled=t>h.u7.FADE_CLICKABLE_THRESHOLD,this.renderOrder=t<h.u7.FADE_OPAQUE?o.X.ghostFloor:o.X.default,this.onOpacityUpdate&&this.onOpacityUpdate(t))}get opacity(){return this._opacity}get chunks(){return this._chunks}getSortKey(){return this.chunks.length?this._chunks[0].getSortKey():0}}c.ShouldCastShadow=!1},3694:(t,e,i)=>{i.d(e,{W:()=>r});var s=i(68909);class r extends s.Mesh{}},96659:(t,e,i)=>{i.d(e,{Io:()=>a,VY:()=>c,cv:()=>u,d$:()=>o,oW:()=>h});var s=i(68909);const r=-1,n=10,o=(t,e=r)=>{function i(i){return t.distanceToSquared(i.position)*e}return Object.defineProperty(i,"name",{value:"_distanceSq"}),i},a=(t,e=r)=>{function i(i){return t.distanceTo(i.position)*e}return Object.defineProperty(i,"name",{value:"_distance"}),i},h=(t,e,i=n)=>{const r=new s.Vector3;function o(s){return r.copy(s.position).sub(t).normalize().dot(e)*i}return Object.defineProperty(o,"name",{value:"_direction"}),o},c=(t,e,i=n)=>{const r=new s.Vector3;function o(s){return r.copy(s.position).sub(t).normalize().dot(e)*i}return Object.defineProperty(o,"name",{value:"_viewDirNorm"}),o},u=(t,e=r)=>{function i(i){return t.distanceToSquared(i.floorPosition)*e}return Object.defineProperty(i,"name",{value:"_floorDistSq"}),i}},35568:(t,e,i)=>{i.d(e,{o:()=>a,A:()=>c});var s=i(68909),r=i(12767),n=i(36476);class o extends s.Object3D{constructor(t){super(),this.anchor=this,this.reset=()=>{this.camera.position.set(0,0,0),this.camera.layers.mask=n.H.ALL.mask,this.camera.updateMatrixWorld(!0)},this.update=t=>{this.anchor.position.copy(t.position),this.camera.quaternion.copy(t.rotation),this.camera.projectionMatrix.copy(t.projection.asThreeMatrix4()),this.camera.projectionMatrixInverse.copy(t.projection.asThreeMatrix4()),this.camera.projectionMatrixInverse.invert(),this.updateMatrixWorld(!0)},this.camera=new s.PerspectiveCamera(r.Bv.fov,t,r.Bv.near,r.Bv.far),this.add(this.camera),this.name="CameraRig",this.reset()}dispose(){this.remove(this.camera)}}var a,h=i(68986);!function(t){t[t.Root=0]="Root",t[t.CameraRig=1]="CameraRig"}(a||(a={}));class c{get lastRenderCallTime(){return this._lastRenderCallTime}constructor(t,e,i,r,n){this.scene=t,this.threeRenderer=e,this.cameraData=i,this.useEffectComposer=r,this.viewportManager=n,this.ids=a,this.frameCount=0,this.rendering=!1,this.composer=null,this.cameraRigStale=!0,this.canvasSizeChanged=!0,this.updateComposer=(()=>{const t=new s.Vector2;return()=>{this.canvasSizeChanged&&this.composer&&(this.composer.setPixelRatio(this.composer.renderer.getPixelRatio()),this.composer.renderer.getSize(t),this.composer.setSize(t.x,t.y),this.canvasSizeChanged=!1)}})(),this.renderViewports=(()=>{const t=new s.Vector2;return e=>{this.threeRenderer.clear();const i=this.cameraRig.camera.layers.mask;for(const i of this.viewportManager.viewports)if(i.rect.getSize(t),this.threeRenderer.setViewport(i.rect.min.x,i.rect.min.y,t.x,t.y),this.composer){const t=this.composer.passes[0];t.scene=i.scene,t.camera=i.camera,this.composer.render(e)}else this.threeRenderer.render(i.scene,i.camera);this.cameraRig.camera.layers.mask=i}})(),this.cameraRig=new o(i.aspect()),n.setDomElement(e.domElement),this.viewportManager.defaultViewport.scene=this.scene,this.viewportManager.defaultViewport.camera=this.cameraRig.camera,e.info.autoReset=!1}add(...t){for(const e of t)this.addChild(a.Root,e)}remove(...t){for(const e of t)this.removeChild(a.Root,e)}addChild(t,e){switch(t){case a.Root:this.scene.add(e);break;case a.CameraRig:this.cameraRig.add(e);break;default:return!1}return!0}removeChild(t,e){switch(t){case a.Root:this.scene.remove(e);break;case a.CameraRig:this.cameraRig.remove(e);break;default:return!1}return!0}get camera(){return this.updateCameraRig(),this.cameraRig.camera}get effectComposer(){return this.composer}init(){this.useEffectComposer&&Promise.all([i.e(1662).then(i.bind(i,42562)),i.e(1662).then(i.bind(i,65804))]).then((([t,e])=>{const i=this.threeRenderer.getSize(new s.Vector2),r=new s.WebGLRenderTarget(i.x,i.y,{stencilBuffer:!0});this.composer=new t.EffectComposer(this.threeRenderer,r),this.composer.addPass(new e.RenderPass(this.scene,this.cameraRig.camera)),this.cameraRigStale=!0})),this.cameraRigStale=!0}dispose(){this.cameraRig.dispose()}startRender(t){this.rendering=t}activate(t){this.scene.add(this.cameraRig),this.cameraDataCallback=()=>this.cameraRigStale=!0,this.cameraData.pose.onChanged(this.cameraDataCallback),this.canvasSizeSub=new h.P(this.cameraData.onPropertyChanged("_width",(()=>this.onCanvasSizeChanged())),this.cameraData.onPropertyChanged("_height",(()=>this.onCanvasSizeChanged())))}deactivate(t){var e;this.scene.remove(this.cameraRig),this.cameraData.pose.removeOnChanged(this.cameraDataCallback),null===(e=this.canvasSizeSub)||void 0===e||e.cancel()}beforeRender(){this.updateCameraRig(),this.updateComposer()}setCameraDirty(){this.cameraRigStale=!0,this.cameraRig.camera.updateProjectionMatrix()}onCanvasSizeChanged(){this.viewportManager.updateDefaultViewport(),this.canvasSizeChanged=!0}updateCameraRig(){this.cameraRigStale&&(this.cameraRig.update(this.cameraData.pose),this.cameraRigStale=!1)}render(t){this.rendering&&(this.threeRenderer.info.reset(),this.renderViewports(t),this.frameCount++),this._lastRenderCallTime=Date.now()}}},30443:(t,e,i)=>{i.d(e,{U7:()=>c,UX:()=>h,Wi:()=>d,h0:()=>n,jF:()=>l,nD:()=>p});var s=i(68909),r=i(81662);function n(t){if(0===t.length)throw Error("Can't merge empty list of geometries");if(1===t.length)return t[0];let e=0,i=0,r=0,n=0;const a=new s.Box3;for(const s of t)s.index&&(e+=s.index.count,i+=s.getAttribute("position").count,s.getAttribute("uv")&&(r+=s.getAttribute("uv").count),s.boundingBox&&(a.union(s.boundingBox),n++));const c=new s.BufferGeometry;n!==t.length||a.isEmpty()?c.computeBoundingBox():c.boundingBox=a,a.copy(h(c)),c.boundingSphere=a.getBoundingSphere(new s.Sphere);const u=o(new Float32Array(3*i),"position",t);c.setAttribute("position",new s.BufferAttribute(u,3));const d=function(t,e){let i=0,s=0;for(const r of e){const e=r.index;for(let r=0;r<e.array.length;r++)t[i+r]=e.array[r]+s;i+=e.array.length,s+=r.getAttribute("position").count}return t}(new Uint32Array(e),t);if(c.setIndex(new s.BufferAttribute(d,1)),r){const e=o(new Float32Array(2*r),"uv",t);c.setAttribute("uv",new s.BufferAttribute(e,2))}return c}function o(t,e,i){let s=0;for(const r of i){const i=r.getAttribute(e);t.set(i.array,s),s+=i.array.length}return t}const a=new s.Box3(r.B1.ZERO,r.B1.UNIT);function h(t){return t.boundingBox||t.computeBoundingBox(),t.boundingBox||a}function c(t,e){let i=1/0;const r=e.clone(),n=new s.Vector3,o=new s.Vector3(1/0,1/0,1/0);let a=-1;const h=new s.Triangle;return function(t,e){var i;const s=null===(i=t.index)||void 0===i?void 0:i.array,r=t.getAttribute("position");if(!r)return;const n=t.groups.length>0?t.groups:[{start:0,count:s?s.length:r.count,materialIndex:0}];let o=0;for(const t of n)for(let i=t.start;i<t.start+t.count;i+=3){let n=i,a=i+1,h=i+2;s&&(n=s[n],a=s[a],h=s[h]),e(r.getX(n),r.getY(n),r.getZ(n),r.getX(a),r.getY(a),r.getZ(a),r.getX(h),r.getY(h),r.getZ(h),o++,t.materialIndex||0)}}(t,((t,e,s,c,u,d,l,p,m,f)=>{h.a.set(t,e,s),h.b.set(c,u,d),h.c.set(l,p,m),h.closestPointToPoint(r,n);const g=r.distanceToSquared(n);g<i&&(o.copy(n),i=g,a=f)})),{point:o,distance:Math.sqrt(i),faceIndex:a}}const u=new s.PlaneGeometry(1,1);function d(){return u}const l=(t,e)=>{e=e||[];for(let t=0;t<8;t++)e[t]=e[t]||new s.Vector3;return e[0].set(t.min.x,t.min.y,t.min.z),e[1].set(t.min.x,t.max.y,t.min.z),e[2].set(t.max.x,t.max.y,t.min.z),e[3].set(t.max.x,t.min.y,t.min.z),e[4].set(t.min.x,t.min.y,t.max.z),e[5].set(t.min.x,t.max.y,t.max.z),e[6].set(t.max.x,t.max.y,t.max.z),e[7].set(t.max.x,t.min.y,t.max.z),e},p=(()=>{const t=new s.Vector3,e=new s.Vector3;return(i,r,n)=>{r=r||new s.Box3,t.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),e.set(Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE);for(const s of i)n&&s.applyMatrix4(n),t.x=Math.min(t.x,s.x),t.y=Math.min(t.y,s.y),t.z=Math.min(t.z,s.z),e.x=Math.max(e.x,s.x),e.y=Math.max(e.y,s.y),e.z=Math.max(e.z,s.z);return r.min.copy(t),r.max.copy(e),r}})()}}]);